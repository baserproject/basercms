{"version":3,"file":"bc_uploader/js/admin/uploader_files/index_panel.bundle.js","mappings":";;;;;;;;;AAaAA,GAAE,WAEE,IAAIC,EAASD,EAAE,WAAWE,OAM1BF,EAAE,WAAWG,SAEb,IAAIC,EAAYJ,EAAE,IAAIK,IAAIL,EAAE,UAAUK,IAAIL,EAAE,SAGxCM,GAFUN,EAAEO,UACEP,EAAE,gBAAgBE,OACnB,MAgIjB,SAASM,IACL,IAAIC,EAAMT,EAAEU,OAAOC,gBAAkB,yCACjCC,EAAQZ,EAAEa,MACdb,EAAEU,OAAOI,aACLd,EAAE,oBAAsBC,GAAQc,OAChCf,EAAEgB,QAAQC,OAAM,WACZ,IAAIC,EAAK,IAAIC,SAMb,OALAD,EAAGE,OAAO,OAAQR,EAAMS,KAAK,SAAS,IACtCH,EAAGE,OAAO,aAAcpB,EAAEgB,QAAQM,KAC9BtB,EAAE,kCAAoCC,GAAQsB,QAC9CL,EAAGE,OAAO,uBAAwBpB,EAAE,kCAAoCC,GAAQc,OAE7Ef,EAAEwB,KAAK,CACVf,IAAKA,EACLgB,KAAM,OACNC,KAAMR,EACNS,SAAU,OACVC,aAAa,EACbC,aAAa,EACbC,OAAO,EACPC,QAASC,GAEjB,GAAG,CAACC,WAAW,EAAOC,YAAY,GAE1C,CAKA,SAASF,EAAqBG,GAEtBA,GACInC,EAAE,kCAAoCC,GAAQsB,SAC9CvB,EAAE,4BAA8BC,GAAQc,IAAIf,EAAE,kCAAoCC,GAAQc,OAC1FT,EAAaN,EAAE,kCAAoCC,GAAQc,OAE/DqB,MAEApC,EAAE,iBAAiBG,SACnBH,EAAE,YAAcC,GAAQoC,QAAQ,wCAA0CC,OAAOC,sBAAwB,QACzGvC,EAAE,YAAYwC,QAKlBxC,EAAE,oBAAsBC,GAAQE,SAChCH,EAAE,kBAAoBC,GAAQmB,OAAO,8BAAgCnB,EAAS,wFAC9ED,EAAE,oBAAsBC,GAAQwC,OAAOjC,GACvCR,EAAEgB,QAAQM,IAAM,IAEpB,CAKA,SAASc,IACLpC,EAAEU,OAAOc,KA4Kb,WACI,IAAIkB,EAAU1C,EAAE,WAAaC,GAAQ0C,KAAK,QACtCC,EAAQ,GACR5C,EAAE,4BAA8BC,GAAQsB,OACxCqB,EAAMC,KAAK,wBAA0B7C,EAAE,4BAA8BC,GAAQc,OAE7E6B,EAAMC,KAAK,yBAEX7C,EAAE,uCAAuCuB,OACzCqB,EAAMC,KAAK,iBAAmB7C,EAAE,uCAAuCe,OAEvE6B,EAAMC,KAAK,qBAEX7C,EAAE,cAAgBC,GAAQc,MAC1B6B,EAAMC,KAAK,QAAUC,UAAU9C,EAAE,cAAgBC,GAAQc,QAEzD6B,EAAMC,KAAK,SAEf,IAAME,EAAMC,SAASC,OAAOC,MAAM,kBAOlC,OANGH,GACCH,EAAMC,KAAK,SAAWE,EAAI,IAE1BH,EAAMrB,SACNmB,GAAW,IAAME,EAAMO,KAAK,MAEzBT,CACX,CAtMkBU,GAAcC,EAA8B,CAACnB,YAAY,EAAOT,KAAM,OACxF,CAQA,SAAS6B,EAAmBC,GACxB,IAAIC,EAAcxD,EAAE,gBAAgBE,OAChCuD,EAAmBzD,EAAE,qBAAqBE,OAC1CwD,EAAgBC,OAAO3D,EAAE,kBAAkBE,QAC3C0D,GAAW,EAMf,OALwB,GAApBH,GAAyBC,GACrBF,GAAeD,IACfK,GAAW,GAGZA,CACX,CA4IA,SAASP,EAA6BQ,GAElC7D,EAAE,YAAcC,GAAQC,KAAK2D,GAzIjC,WAEwB7D,EAAE,kBAAkBE,OAEpCI,GACAN,EAAE,kCAAoCC,GAAQc,IAAIT,GAGtDN,EAAE,oBAAoB8D,OAAO,qBAC7B9D,EAAE,oBAAoB8D,OAAO,0BAC7B9D,EAAE,oBAAoB8D,OAAO,0BAC7B9D,EAAE,mBAAmB8D,OAAO,yBAC5B9D,EAAE,oBAAoB8D,OAAO,0BAC7B9D,EAAE,mBAAmB8D,OAAO,qBAC5B9D,EAAE,eAAe8D,OAAO,SAGxB,IAAIC,EAA2B,OAE3B/D,EAAEgE,GAAGC,cAAgBhE,GAAUD,EAAE,iBAAiBuB,QAElDvB,EAAE,iBAAiBiE,YAAY,CAC3BC,SAAU,mBACVC,SAAUC,EACVC,MAAO,SAAUC,EAAUC,GACvB,IAAIX,EAAWN,EAAmBtD,EAAEsE,GAAUE,KAAK,YAAYtE,QAC/D,MAAO,CACHuE,MAAO,CACHC,KAAM,CACFC,KAAMrC,OAAOsC,aACbC,KAAM,OACNjB,SAAU,SAAUtC,EAAKwD,GACrB,OAAOlB,CACX,GAEJmB,OAAQ,CACJJ,KAAMrC,OAAO0C,eACbH,KAAM,SACNjB,SAAU,SAAUtC,EAAKwD,GACrB,OAAOlB,CACX,IAIhB,IAIR5D,EAAE,kCAAkCiF,MAAK,WAEjCjF,EAAEgE,GAAGC,cAAgBhE,EAChBqD,EAAmBtD,EAAEa,MAAM2D,KAAK,YAAYtE,QAK7CF,EAAEa,MAAMqE,KAAK,0BAA0B,WACnCC,MAAM7C,OAAO8C,sBACjB,IANApF,EAAEa,MAAMqE,KAAK,0BAA0B,WACnClF,EAAE,eAAeqF,OAAO,OAC5B,IAOJrF,EAAEa,MAAMqE,KAAK,eAAe,SAAUX,GAClC,OAAO,CACX,IAIAvE,EAAEa,MAAMyE,SAAS,cACjBtF,EAAEa,MAAM0E,IAAI,mBAAoBxB,EAExC,IAGA/D,EAAE,oBAAsBC,GAAQwC,OAAOjC,GAEnCP,GACAD,EAAE,oBAAoBkF,KAAK,0BAA0B,WACjDlF,EAAEa,MAAM0E,IAAI,mBAAoB,UACpC,IACAvF,EAAE,oBAAoBkF,KAAK,0BAA0B,WACjDlF,EAAEa,MAAM0E,IAAI,mBAAoB,WAC5BvF,EAAEa,MAAMyE,SAAS,cACjBtF,EAAEa,MAAM0E,IAAI,mBAAoBxB,EAExC,IACA/D,EAAE,oBAAoBiF,MAAK,WAEvBjF,EAAEa,MAAMqE,KAAK,aAAa,WACtBlF,EAAE,oBAAoBwF,YAAY,YAClCxF,EAAEa,MAAM4E,SAAS,WACrB,GACJ,MAEAzF,EAAE,kCAAkCkF,KAAK,0BAA0B,WAC/DlF,EAAEa,MAAM0E,IAAI,mBAAoB,UACpC,IACAvF,EAAE,kCAAkCkF,KAAK,0BAA0B,WAC/DlF,EAAEa,MAAM0E,IAAI,mBAAoB,WAC5BvF,EAAEa,MAAMyE,SAAS,cACjBtF,EAAEa,MAAM0E,IAAI,mBAAoBxB,EAExC,IACA/D,EAAE,kCAAkCiF,MAAK,WAErCjF,EAAEa,MAAMqE,KAAK,aAAa,WACtBlF,EAAE,oBAAoBwF,YAAY,YAClCxF,EAAEa,MAAM4E,SAAS,WACrB,GACJ,KAIJzF,EAAE,mBAAmBkF,KAAK,yBAAyB,WAG/C,OAFAlF,EAAE,YAAY0F,OACd1F,EAAE2F,IAAI3F,EAAEa,MAAM8B,KAAK,QAASU,IACrB,CACX,IAWArD,EAAE,YAAcC,GAAQ2F,QAAQ,gBAChC5F,EAAE,YAAcC,GAAQ4F,OAAO,YAAa,CAAC,EAAG,KAEpD,CAQIC,GACA9F,EAAE,YAAcC,GAAQ2F,QAAQ,qBAChC5F,EAAE,YAAYwC,MAElB,CAoCA,SAAS4B,EAAkB2B,EAAQC,GAC/B,IAAIC,EAAKjG,EAAE,YAAcC,EAAS,kBAAkBC,OAAOgG,OACvDC,EAASnG,EAAEU,OAAOC,gBAAkB,qCAAuCsF,EAAK,QAGhFG,EAAML,EAAOM,QAAQ,KAGzB,QAFa,IAATD,IAAYL,EAASA,EAAOO,UAAUF,EAAM,EAAGL,EAAOxE,SAElDwE,GACJ,IAAK,OACD/F,EAAE,eAAeqF,OAAO,QACxB,MAEJ,IAAK,SACGkB,QAAQjE,OAAOkE,0BACfxG,EAAEgB,QAAQC,OAAM,WACZjB,EAAEwB,KAAK,CACHf,IAAK0F,EACLM,QAAS,CACL,eAAgBzG,EAAEgB,QAAQM,KAE9BG,KAAM,OACNE,SAAU,OACV+E,WAAY,WACR1G,EAAE,YAAY0F,MAClB,EACA3D,QAAS,WACL/B,EAAE,YAAcC,GAAQ2F,QAAQ,kBAChCxD,GACJ,EACAuE,MAAO,WACHxB,MAAM7C,OAAOsE,sBACjB,EACAC,SAAU,WACN7G,EAAE,YAAYwC,OACdxC,EAAEgB,QAAQM,IAAM,IACpB,GAER,GAAG,CAACW,WAAW,EAAOC,YAAY,IAIlD,CA1aAE,IAEApC,EAAE,cAAc8G,OAAM,WAElB,OADA1E,KACO,CACX,IAGApC,EAAE,eAAeqF,OAAO,CACpB0B,UAAU,EACVC,UAAU,EACVC,SAAU,CAACC,GAAI,gBAAiBC,GAAIC,QACpCC,MAAO,IACPC,OAAO,EACPC,KAAM,WACF,IAAI5C,EAAO3E,EAAE,YAAcC,EAAS,oBAAoBC,OACxDF,EAAE,qBAAuBC,EAAS,+BAA+BE,SACjEH,EAAE,yBAA2BC,GAAQyF,OACrC1F,EAAE,kBAAoBC,GAAQc,IAAIf,EAAE,YAAcC,EAAS,kBAAkBC,OAAOgG,QACpFlG,EAAE,oBAAsBC,GAAQc,IAAI4D,GACpC3E,EAAE,mBAAqBC,GAAQc,IAAIf,EAAE,YAAcC,EAAS,mBAAmBC,QAG/E,IAAIsH,EAAmBxH,EAAE,YAAcC,EAAS,6BAA6BC,OAAOgG,OAChFuB,EAAmBzH,EAAE,YAAcC,EAAS,kCAAkCC,OAAOgG,OACzFlG,EAAE,kCAAkCe,IAAIyG,GACxCxH,EAAE,kCAAkCe,IAAI0G,GACxC,IAAIC,EAAuBF,EACvBC,IACAC,GAAwB,IAAMD,GAElCzH,EAAE,6BAA6Be,IAAI2G,GAGnC,IAAIC,EAAiB3H,EAAE,YAAcC,EAAS,2BAA2BC,OAAOgG,OAC5E0B,EAAiB5H,EAAE,YAAcC,EAAS,gCAAgCC,OAAOgG,OACrFlG,EAAE,gCAAgCe,IAAI4G,GACtC3H,EAAE,gCAAgCe,IAAI6G,GACtC,IAAIC,EAAqBF,EACrBC,IACAC,GAAsB,IAAMD,GAEhC5H,EAAE,2BAA2Be,IAAI8G,GAEjC7H,EAAE,sBAAwBC,GAAQc,IAAIf,EAAE,YAAcC,EAAS,uBAAuBC,QACtFF,EAAE,wBAA0BC,GAAQC,KAAKF,EAAE,YAAcC,EAAS,yBAAyBC,QACvFF,EAAE,mCAAqCC,GAAQsB,QAC/CvB,EAAE,mCAAqCC,GAAQc,IAAIf,EAAE,YAAcC,EAAS,oCAAoCC,QAEpHF,EAAEwB,KAAK,CACHf,IAAKT,EAAEU,OAAOoH,aAAe,yCAA2CnD,EAAO,SAC/ElD,KAAM,MACNE,SAAU,OACVI,QAAS,SAAUI,GACfnC,EAAE,yBAA2BC,GAAQuC,OACrCxC,EAAE,yBAA2BC,GAAQ8H,MAAM5F,EAC/C,GAER,EACA6F,QAAS,CACLC,OAAQ,CACJC,KAAM5F,OAAO6F,eACbrB,MAAO,WACH9G,EAAEa,MAAMwE,OAAO,QACnB,GAEJ+C,KAAM,CACFF,KAAM5F,OAAO+F,aACbvB,MAAO,WAEH,IAAIwB,EAAatI,EAAEa,MACfoF,EAAKjG,EAAE,kBAAoBC,GAAQc,MACvCf,EAAEgB,QAAQC,OAAM,WAEZ,IAAIS,EAAO,CACP,GAAMuE,EACN,KAAQjG,EAAE,oBAAsBC,GAAQc,MACxC,IAAOf,EAAE,mBAAqBC,GAAQc,MACtC,cAAiBf,EAAE,4BAA8BC,GAAQc,MACzD,YAAef,EAAE,0BAA4BC,GAAQc,MACrD,QAAWf,EAAE,sBAAwBC,GAAQc,MAC7C,qBAAwBf,EAAE,mCAAqCC,GAAQc,MACvE,WAAcf,EAAEgB,QAAQM,KAE5B,OAAOtB,EAAEwB,KAAK,CACVf,IAAKT,EAAEU,OAAOC,gBAAkB,mCAAqCsF,EAAK,QAC1ExE,KAAM,OACNC,KAAMA,EACNC,SAAU,OACVI,QAAS,WACLK,IACAhC,EAAUoF,YAAY,kBACtB8C,EAAWjD,OAAO,QACtB,EACAsB,MAAO,SAAU4B,GACb,IAAMC,EAAS,CACX7D,KAAMrC,OAAOmG,aACbC,cAAepG,OAAOqG,qBACtBC,YAAatG,OAAOuG,oBAEpBC,EAAUP,EAASQ,aAAaD,aACAE,IAAjCT,EAASQ,aAAaE,SACrBH,GAAW,KACXI,OAAOC,KAAKZ,EAASQ,aAAaE,QAAQG,SAAQ,SAAU9H,GACxD4H,OAAOC,KAAKZ,EAASQ,aAAaE,OAAO3H,IAAM8H,SAAQ,SAAUC,GAC7DP,GAAW,MAAQN,EAAOlH,GAAO,IAAMiH,EAASQ,aAAaE,OAAO3H,GAAK+H,EAC7E,GACJ,KAEJlE,MAAM2D,EACV,GAER,GAAG,CAAC5G,YAAY,EAAOD,WAAW,GACtC,IAGRqH,MAAO,WACHlJ,EAAUW,IAAI,IAAIyE,YAAY,iBAClC,GAsTR","sources":["webpack://bc-admin-third/./src/bc_uploader/js/admin/uploader_files/index_panel.js"],"sourcesContent":["/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) NPO baser foundation <https://baserfoundation.org/>\n *\n * @copyright     Copyright (c) NPO baser foundation\n * @link          https://basercms.net baserCMS Project\n * @since         5.0.0\n * @license       https://basercms.net/license/index.html MIT License\n */\n\n/**\n * 起動時処理\n */\n$(function () {\n\n    var listId = $(\"#ListId\").html();\n\n    //==========================================================================\n    // 複数のエディタよりリストが呼出される可能性がある為、#ListIdの値を読み込んだら削除する\n    // TODO 強引すぎるので他の方法がないか検討要\n    //==========================================================================\n    $(\"#ListId\").remove();\n\n    var allFields = $([]).add($(\"#name\")).add($(\"#alt\"));\n    var baseUrl = $.baseUrl() + '/';\n    var adminPrefix = $(\"#AdminPrefix\").html();\n    var categoryId = null;\n\n    // 一覧を更新する\n    updateFileList();\n\n    $(\"#BtnFilter\").click(function(){\n        updateFileList();\n        return false;\n    });\n\n    /* ダイアログを初期化 */\n    $(\"#EditDialog\").dialog({\n        bgiframe: true,\n        autoOpen: false,\n        position: {at: \"center center\", of: window},\n        width: 960,\n        modal: true,\n        open: function () {\n            var name = $(\"#FileList\" + listId + \" .selected .name\").html();\n            $(\"#UploaderFileImage\" + listId + ' .uploader-file-image-inner').remove();\n            $(\"#UploadFileImageLoader\" + listId).show();\n            $(\"#UploaderFileId\" + listId).val($(\"#FileList\" + listId + \" .selected .id\").html().trim());\n            $(\"#UploaderFileName\" + listId).val(name);\n            $(\"#UploaderFileAlt\" + listId).val($(\"#FileList\" + listId + \" .selected .alt\").html());\n\n            /* ダイアログ初期化時、hidden値が空になるため公開期間開始日時を取得して hidden値に入れ込む */\n            var publishBeginDate = $(\"#FileList\" + listId + \" .selected .publish-begin\").html().trim();\n            var publishBeginTime = $(\"#FileList\" + listId + \" .selected .publish-begin-time\").html().trim();\n            $(\"#UploaderFilePublishBegin-date\").val(publishBeginDate);\n            $(\"#UploaderFilePublishBegin-time\").val(publishBeginTime);\n            var publishBeginDateTime = publishBeginDate;\n            if (publishBeginTime) {\n                publishBeginDateTime += ' ' + publishBeginTime;\n            }\n            $(\"#UploaderFilePublishBegin\").val(publishBeginDateTime);\n\n            /* ダイアログ初期化時、hidden値が空になるため公開期間終了日時を取得して hidden値に入れ込む */\n            var publishEndDate = $(\"#FileList\" + listId + \" .selected .publish-end\").html().trim();\n            var publishEndTime = $(\"#FileList\" + listId + \" .selected .publish-end-time\").html().trim();\n            $(\"#UploaderFilePublishEnd-date\").val(publishEndDate);\n            $(\"#UploaderFilePublishEnd-time\").val(publishEndTime);\n            var publishEndDateTime = publishEndDate;\n            if (publishEndTime) {\n                publishEndDateTime += ' ' + publishEndTime;\n            }\n            $(\"#UploaderFilePublishEnd\").val(publishEndDateTime);\n\n            $(\"#UploaderFileUserId\" + listId).val($(\"#FileList\" + listId + \" .selected .user-id\").html());\n            $(\"#UploaderFileUserName\" + listId).html($(\"#FileList\" + listId + \" .selected .user-name\").html());\n            if ($(\"#_UploaderFileUploaderCategoryId\" + listId).length) {\n                $(\"#_UploaderFileUploaderCategoryId\" + listId).val($(\"#FileList\" + listId + \" .selected .uploader-category-id\").html());\n            }\n            $.ajax({\n                url: $.bcUtil.adminBaseUrl + 'bc-uploader/uploader_files/ajax_image/' + name + '/large',\n                type: 'get',\n                dataType: 'html',\n                success: function (res) {\n                    $(\"#UploadFileImageLoader\" + listId).hide();\n                    $(\"#UploadFileImageLoader\" + listId).after(res);\n                }\n            });\n        },\n        buttons: {\n            cancel: {\n                text: bcI18n.uploaderCancel,\n                click: function () {\n                    $(this).dialog('close');\n                }\n            },\n            save: {\n                text: bcI18n.uploaderSave,\n                click: function () {\n                    // 保存処理\n                    let saveButton = $(this);\n                    let id = $(\"#UploaderFileId\" + listId).val();\n                    $.bcToken.check(function () {\n                        // IEでform.serializeを利用した場合、Formタグの中にTableタグがあるとデータが取得できなかった\n                        var data = {\n                            \"id\": id,\n                            \"name\": $(\"#UploaderFileName\" + listId).val(),\n                            \"alt\": $(\"#UploaderFileAlt\" + listId).val(),\n                            \"publish_begin\": $(\"#UploaderFilePublishBegin\" + listId).val(),\n                            \"publish_end\": $(\"#UploaderFilePublishEnd\" + listId).val(),\n                            \"user_id\": $(\"#UploaderFileUserId\" + listId).val(),\n                            \"uploader_category_id\": $(\"#_UploaderFileUploaderCategoryId\" + listId).val(),\n                            \"_csrfToken\": $.bcToken.key\n                        };\n                        return $.ajax({\n                            url: $.bcUtil.apiAdminBaseUrl + 'bc-uploader/uploader_files/edit/' + id + '.json',\n                            type: 'post',\n                            data: data,\n                            dataType: 'json',\n                            success: function () {\n                                updateFileList();\n                                allFields.removeClass('ui-state-error');\n                                saveButton.dialog('close');\n                            },\n                            error: function (response) {\n                                const fields = {\n                                    name: bcI18n.uploaderFile,\n                                    publish_begin: bcI18n.uploaderPublishBegin,\n                                    publish_end: bcI18n.uploaderPublishEnd\n                                };\n                                let message = response.responseJSON.message;\n                                if(response.responseJSON.errors !== undefined) {\n                                    message += \"\\n\";\n                                    Object.keys(response.responseJSON.errors).forEach(function (key) {\n                                        Object.keys(response.responseJSON.errors[key]).forEach(function (field) {\n                                            message += \"\\n・\" + fields[key] + '：' + response.responseJSON.errors[key][field];\n                                        });\n                                    });\n                                }\n                                alert(message);\n                            }\n                        });\n                    }, {hideLoader: false, useUpdate: false});\n                }\n            }\n        },\n        close: function () {\n            allFields.val('').removeClass('ui-state-error');\n        }\n\n    });\n\n    /**\n     * アップロードファイル選択時イベント\n     */\n    function uploaderFileFileChangeHandler() {\n        var url = $.bcUtil.apiAdminBaseUrl + 'bc-uploader/uploader_files/upload.json';\n        var $file = $(this);\n        $.bcUtil.showLoader();\n        if ($('#UploaderFileFile' + listId).val()) {\n            $.bcToken.check(function () {\n                let fd = new FormData();\n                fd.append('file', $file.prop('files')[0]);\n                fd.append('_csrfToken', $.bcToken.key);\n                if ($(\"#UploaderFileUploaderCategoryId\" + listId).length) {\n                    fd.append('uploader_category_id', $(\"#UploaderFileUploaderCategoryId\" + listId).val());\n                }\n                return $.ajax({\n                    url: url,\n                    type: 'post',\n                    data: fd,\n                    dataType: 'json',\n                    processData: false,\n                    contentType: false,\n                    cache: false,\n                    success: uploadSuccessHandler\n                });\n            }, {useUpdate: false, hideLoader: false});\n        }\n    }\n\n    /**\n     * アップロード完了後イベント\n     */\n    function uploadSuccessHandler(res) {\n\n        if (res) {\n            if ($('#UploaderFileUploaderCategoryId' + listId).length) {\n                $('#FilterUploaderCategoryId' + listId).val($('#UploaderFileUploaderCategoryId' + listId).val());\n                categoryId = $('#UploaderFileUploaderCategoryId' + listId).val();\n            }\n            updateFileList();\n        } else {\n            $('#ErrorMessage').remove();\n            $('#FileList' + listId).prepend('<p id=\"ErrorMessage\" class=\"message\">' + bcI18n.uploaderAlertMessage2 + '</p>');\n            $(\"#Waiting\").hide();\n        }\n        // フォームを初期化\n        // セキュリティ上の関係でvalue値を直接消去する事はできないので、一旦エレメントごと削除し、\n        // spanタグ内に新しく作りなおす。\n        $(\"#UploaderFileFile\" + listId).remove();\n        $(\"#SpanUploadFile\" + listId).append('<input id=\"UploaderFileFile' + listId + '\" type=\"file\" value=\"\" name=\"data[UploaderFile][file]\" class=\"uploader-file-file\" />');\n        $('#UploaderFileFile' + listId).change(uploaderFileFileChangeHandler);\n        $.bcToken.key = null;\n\n    }\n\n    /**\n     * 一覧を更新する\n     */\n    function updateFileList() {\n        $.bcUtil.ajax(getListUrl(), updateFileListCompleteHander, {hideLoader: false, type: 'GET'});\n    }\n\n    /**\n     * 指定したファイルの編集ができない状態か確認\n     *\n     * @param fileUserId\n     * @returns {boolean}\n     */\n    function isFileEditDisabled(fileUserId) {\n        var loginUserId = $(\"#LoginUserId\").html();\n        var loginUserGroupId = $(\"#LoginUserGroupId\").html();\n        var usePermission = Number($(\"#UsePermission\").html());\n        var disabled = false;\n        if (loginUserGroupId != 1 && usePermission) {\n            if (loginUserId != fileUserId) {\n                disabled = true;\n            }\n        }\n        return disabled;\n    }\n\n    /**\n     * 選択イベントを初期化する\n     */\n    function initFileList() {\n\n        var usePermission = $(\"#UsePermission\").html();\n\n        if (categoryId) {\n            $('#UploaderFileUploaderCategoryId' + listId).val(categoryId);\n        }\n        /* 一旦イベントを全て解除 */\n        $(\".selectable-file\").unbind('click.selectEvent');\n        $(\".selectable-file\").unbind('mouseenter.selectEvent');\n        $(\".selectable-file\").unbind('mouseleave.selectEvent');\n        $(\".page-numbers a\").unbind('click.paginationEvent');\n        $(\".selectable-file\").unbind('dblclick.dblclickEvent');\n        $(\".filter-control\").unbind('click.filterEvent');\n        $(\".btn-delete\").unbind('click');\n\n        /* 公開制限期間にあるファイルの背景色を定義 */\n        var unpublishBackGroundColor = '#bbb';\n\n        if ($.fn.contextMenu && !listId && $(\"#DivPanelList\").length) {\n            /* 右クリックメニューを追加 */\n            $(\"#DivPanelList\").contextMenu({\n                selector: '.selectable-file',\n                callback: contextMenuHander,\n                build: function ($trigger, e) {\n                    var disabled = isFileEditDisabled($($trigger).find('.user-id').html());\n                    return {\n                        items: {\n                            edit: {\n                                name: bcI18n.uploaderEdit,\n                                icon: 'edit',\n                                disabled: function (key, opt) {\n                                    return disabled;\n                                }\n                            },\n                            delete: {\n                                name: bcI18n.uploaderDelete,\n                                icon: 'delete',\n                                disabled: function (key, opt) {\n                                    return disabled;\n                                }\n                            }\n                        }\n                    }\n                }\n            });\n        }\n\n        $(\"#DivPanelList .selectable-file\").each(function () {\n\n            if ($.fn.contextMenu && !listId) {\n                if (!isFileEditDisabled($(this).find('.user-id').html())) {\n                    $(this).bind('dblclick.dblclickEvent', function () {\n                        $('#EditDialog').dialog('open');\n                    });\n                } else {\n                    $(this).bind('dblclick.dblclickEvent', function () {\n                        alert(bcI18n.uploaderAlertMessage3);\n                    });\n                }\n            } else {\n                $(this).bind(\"contextmenu\", function (e) {\n                    return false;\n                });\n            }\n\n            /* 公開制限期間にあるファイルは背景色をグレーにする */\n            if ($(this).hasClass('unpublish')) {\n                $(this).css('background-color', unpublishBackGroundColor);\n            }\n        });\n\n        // ファイルアップロードイベントを登録\n        $('#UploaderFileFile' + listId).change(uploaderFileFileChangeHandler);\n\n        if (listId) {\n            $(\".selectable-file\").bind('mouseenter.selectEvent', function () {\n                $(this).css('background-color', '#fffae7');\n            });\n            $(\".selectable-file\").bind('mouseleave.selectEvent', function () {\n                $(this).css('background-color', '#FFFFFF');\n                if ($(this).hasClass('unpublish')) {\n                    $(this).css('background-color', unpublishBackGroundColor);\n                }\n            });\n            $(\".selectable-file\").each(function () {\n                // IEの場合contextmenuを検出できなかったので、mousedownに変更した\n                $(this).bind('mousedown', function () {\n                    $(\".selectable-file\").removeClass('selected');\n                    $(this).addClass('selected');\n                });\n            });\n        } else {\n            $(\"#DivPanelList .selectable-file\").bind('mouseenter.selectEvent', function () {\n                $(this).css('background-color', '#fffae7');\n            });\n            $(\"#DivPanelList .selectable-file\").bind('mouseleave.selectEvent', function () {\n                $(this).css('background-color', '#FFFFFF');\n                if ($(this).hasClass('unpublish')) {\n                    $(this).css('background-color', unpublishBackGroundColor);\n                }\n            });\n            $(\"#DivPanelList .selectable-file\").each(function () {\n                // IEの場合contextmenuを検出できなかったので、mousedownに変更した\n                $(this).bind('mousedown', function () {\n                    $(\".selectable-file\").removeClass('selected');\n                    $(this).addClass('selected');\n                });\n            });\n        }\n\n        /* ページネーションイベントを追加 */\n        $('.page-numbers a').bind('click.paginationEvent', function () {\n            $(\"#Waiting\").show();\n            $.get($(this).attr('href'), updateFileListCompleteHander);\n            return false;\n        });\n\n        /*$('#FilterUploaderCategoryId'+listId).bind('change.filterEvent', function() {\n            $(\"#Waiting\").show();\n            $.get(getListUrl(),updateFileListCompleteHander);\n        });\n        $('input[name=\"data[Filter][uploader_type]\"]').bind('click.filterEvent', function() {\n            $(\"#Waiting\").show();\n            $.get(getListUrl(),updateFileListCompleteHander);\n        });*/\n\n        $(\"#FileList\" + listId).trigger(\"filelistload\");\n        $(\"#FileList\" + listId).effect(\"highlight\", {}, 1500);\n\n    }\n\n    /**\n     * ファイルリスト取得完了イベント\n     */\n    function updateFileListCompleteHander(result) {\n\n        $(\"#FileList\" + listId).html(result);\n        initFileList();\n        $(\"#FileList\" + listId).trigger('loadTableComplete');\n        $(\"#Waiting\").hide();\n\n    }\n\n    /**\n     * Ajax List 取得用のURLを取得する\n     */\n    function getListUrl() {\n        let listUrl = $(\"#ListUrl\" + listId).attr('href');\n        let query = [];\n        if ($('#FilterUploaderCategoryId' + listId).length) {\n            query.push('uploader_category_id=' + $('#FilterUploaderCategoryId' + listId).val());\n        } else {\n            query.push('uploader_category_id=');\n        }\n        if ($('input[name=\"uploader_type\"]:checked').length) {\n            query.push('uploader_type=' + $('input[name=\"uploader_type\"]:checked').val());\n        } else {\n            query.push('uploader_type=all');\n        }\n        if ($('#FilterName' + listId).val()) {\n            query.push('name=' + encodeURI($('#FilterName' + listId).val()));\n        } else {\n            query.push('name=');\n        }\n        const num = location.search.match('limit=([0-9]+)');\n        if(num) {\n            query.push('limit=' + num[1]);\n        }\n        if (query.length) {\n            listUrl += '?' + query.join('&');\n        }\n        return listUrl;\n    }\n\n    /**\n     * コンテキストメニューハンドラ\n     */\n    function contextMenuHander(action, el) {\n        let id = $(\"#FileList\" + listId + \" .selected .id\").html().trim();\n        let delUrl = $.bcUtil.apiAdminBaseUrl + 'bc-uploader/uploader_files/delete/' + id + '.json';\n\n        // IEの場合、action値が正常に取得できないので整形する\n        let pos = action.indexOf(\"#\");\n        if (pos !== -1) action = action.substring(pos + 1, action.length);\n\n        switch (action) {\n            case 'edit':\n                $('#EditDialog').dialog('open');\n                break;\n\n            case 'delete':\n                if (confirm(bcI18n.uploaderConfirmMessage1)) {\n                    $.bcToken.check(function () {\n                        $.ajax({\n                            url: delUrl,\n                            headers: {\n                                \"X-CSRF-Token\": $.bcToken.key,\n                            },\n                            type: 'post',\n                            dataType: 'json',\n                            beforeSend: function() {\n                                $(\"#Waiting\").show();\n                            },\n                            success: function () {\n                                $(\"#FileList\" + listId).trigger(\"deletecomplete\");\n                                updateFileList();\n                            },\n                            error: function () {\n                                alert(bcI18n.uploaderAlertMessage4);\n                            },\n                            complete: function(){\n                                $(\"#Waiting\").hide();\n                                $.bcToken.key = null;\n                            }\n                        });\n                    }, {useUpdate: false, hideLoader: false});\n                }\n                break;\n        }\n    }\n\n});\n"],"names":["$","listId","html","remove","allFields","add","categoryId","baseUrl","uploaderFileFileChangeHandler","url","bcUtil","apiAdminBaseUrl","$file","this","showLoader","val","bcToken","check","fd","FormData","append","prop","key","length","ajax","type","data","dataType","processData","contentType","cache","success","uploadSuccessHandler","useUpdate","hideLoader","res","updateFileList","prepend","bcI18n","uploaderAlertMessage2","hide","change","listUrl","attr","query","push","encodeURI","num","location","search","match","join","getListUrl","updateFileListCompleteHander","isFileEditDisabled","fileUserId","loginUserId","loginUserGroupId","usePermission","Number","disabled","result","unbind","unpublishBackGroundColor","fn","contextMenu","selector","callback","contextMenuHander","build","$trigger","e","find","items","edit","name","uploaderEdit","icon","opt","delete","uploaderDelete","each","bind","alert","uploaderAlertMessage3","dialog","hasClass","css","removeClass","addClass","show","get","trigger","effect","initFileList","action","el","id","trim","delUrl","pos","indexOf","substring","confirm","uploaderConfirmMessage1","headers","beforeSend","error","uploaderAlertMessage4","complete","click","bgiframe","autoOpen","position","at","of","window","width","modal","open","publishBeginDate","publishBeginTime","publishBeginDateTime","publishEndDate","publishEndTime","publishEndDateTime","adminBaseUrl","after","buttons","cancel","text","uploaderCancel","save","uploaderSave","saveButton","response","fields","uploaderFile","publish_begin","uploaderPublishBegin","publish_end","uploaderPublishEnd","message","responseJSON","undefined","errors","Object","keys","forEach","field","close"],"sourceRoot":""}
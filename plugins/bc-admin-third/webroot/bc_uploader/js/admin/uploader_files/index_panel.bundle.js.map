{"version":3,"file":"bc_uploader/js/admin/uploader_files/index_panel.bundle.js","mappings":"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","sources":["webpack://bc-admin-third/./src/bc_uploader/js/admin/uploader_files/index_panel.js"],"sourcesContent":["/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) NPO baser foundation <https://baserfoundation.org/>\n *\n * @copyright     Copyright (c) NPO baser foundation\n * @link          https://basercms.net baserCMS Project\n * @since         5.0.0\n * @license       https://basercms.net/license/index.html MIT License\n */\n\n/**\n * 起動時処理\n */\n$(function () {\n\n    var listId = $(\"#ListId\").html();\n\n    //==========================================================================\n    // 複数のエディタよりリストが呼出される可能性がある為、#ListIdの値を読み込んだら削除する\n    // TODO 強引すぎるので他の方法がないか検討要\n    //==========================================================================\n    $(\"#ListId\").remove();\n\n    var allFields = $([]).add($(\"#name\")).add($(\"#alt\"));\n    var baseUrl = $.baseUrl() + '/';\n    var adminPrefix = $(\"#AdminPrefix\").html();\n    var categoryId = null;\n\n    // 一覧を更新する\n    updateFileList();\n\n    $(\"#BtnFilter\").click(function(){\n        updateFileList();\n        return false;\n    });\n\n    /* ダイアログを初期化 */\n    $(\"#EditDialog\").dialog({\n        bgiframe: true,\n        autoOpen: false,\n        position: {at: \"center center\", of: window},\n        width: 960,\n        modal: true,\n        open: function () {\n            var name = $(\"#FileList\" + listId + \" .selected .name\").html();\n            $(\"#UploaderFileImage\" + listId + ' .uploader-file-image-inner').remove();\n            $(\"#UploadFileImageLoader\" + listId).show();\n            $(\"#UploaderFileId\" + listId).val($(\"#FileList\" + listId + \" .selected .id\").html().trim());\n            $(\"#UploaderFileName\" + listId).val(name);\n            $(\"#UploaderFileAlt\" + listId).val($(\"#FileList\" + listId + \" .selected .alt\").html());\n\n            /* ダイアログ初期化時、hidden値が空になるため公開期間開始日時を取得して hidden値に入れ込む */\n            var publishBeginDate = $(\"#FileList\" + listId + \" .selected .publish-begin\").html().trim();\n            var publishBeginTime = $(\"#FileList\" + listId + \" .selected .publish-begin-time\").html().trim();\n            $(\"#UploaderFilePublishBegin-date\").val(publishBeginDate);\n            $(\"#UploaderFilePublishBegin-time\").val(publishBeginTime);\n            var publishBeginDateTime = publishBeginDate;\n            if (publishBeginTime) {\n                publishBeginDateTime += ' ' + publishBeginTime;\n            }\n            $(\"#UploaderFilePublishBegin\").val(publishBeginDateTime);\n\n            /* ダイアログ初期化時、hidden値が空になるため公開期間終了日時を取得して hidden値に入れ込む */\n            var publishEndDate = $(\"#FileList\" + listId + \" .selected .publish-end\").html().trim();\n            var publishEndTime = $(\"#FileList\" + listId + \" .selected .publish-end-time\").html().trim();\n            $(\"#UploaderFilePublishEnd-date\").val(publishEndDate);\n            $(\"#UploaderFilePublishEnd-time\").val(publishEndTime);\n            var publishEndDateTime = publishEndDate;\n            if (publishEndTime) {\n                publishEndDateTime += ' ' + publishEndTime;\n            }\n            $(\"#UploaderFilePublishEnd\").val(publishEndDateTime);\n\n            $(\"#UploaderFileUserId\" + listId).val($(\"#FileList\" + listId + \" .selected .user-id\").html());\n            $(\"#UploaderFileUserName\" + listId).html($(\"#FileList\" + listId + \" .selected .user-name\").html());\n            if ($(\"#_UploaderFileUploaderCategoryId\" + listId).length) {\n                $(\"#_UploaderFileUploaderCategoryId\" + listId).val($(\"#FileList\" + listId + \" .selected .uploader-category-id\").html());\n            }\n            $.ajax({\n                url: $.bcUtil.adminBaseUrl + 'bc-uploader/uploader_files/ajax_image/' + name + '/large',\n                headers: {\n                    \"Authorization\": $.bcJwt.accessToken,\n                },\n                type: 'get',\n                dataType: 'html',\n                success: function (res) {\n                    $(\"#UploadFileImageLoader\" + listId).hide();\n                    $(\"#UploadFileImageLoader\" + listId).after(res);\n                }\n            });\n        },\n        buttons: {\n            cancel: {\n                text: bcI18n.uploaderCancel,\n                click: function () {\n                    $(this).dialog('close');\n                }\n            },\n            save: {\n                text: bcI18n.uploaderSave,\n                click: function () {\n                    // 保存処理\n                    let saveButton = $(this);\n                    let id = $(\"#UploaderFileId\" + listId).val();\n                    $.bcToken.check(function () {\n                        // IEでform.serializeを利用した場合、Formタグの中にTableタグがあるとデータが取得できなかった\n                        var data = {\n                            \"id\": id,\n                            \"name\": $(\"#UploaderFileName\" + listId).val(),\n                            \"alt\": $(\"#UploaderFileAlt\" + listId).val(),\n                            \"publish_begin\": $(\"#UploaderFilePublishBegin\" + listId).val(),\n                            \"publish_end\": $(\"#UploaderFilePublishEnd\" + listId).val(),\n                            \"user_id\": $(\"#UploaderFileUserId\" + listId).val(),\n                            \"uploader_category_id\": $(\"#_UploaderFileUploaderCategoryId\" + listId).val(),\n                            \"_csrfToken\": $.bcToken.key\n                        };\n                        return $.ajax({\n                            url: $.bcUtil.apiAdminBaseUrl + 'bc-uploader/uploader_files/edit/' + id + '.json',\n                            headers: {\n                                \"Authorization\": $.bcJwt.accessToken,\n                            },\n                            type: 'post',\n                            data: data,\n                            dataType: 'json',\n                            success: function () {\n                                updateFileList();\n                                allFields.removeClass('ui-state-error');\n                                saveButton.dialog('close');\n                            },\n                            error: function (response) {\n                                const fields = {\n                                    name: bcI18n.uploaderFile,\n                                    publish_begin: bcI18n.uploaderPublishBegin,\n                                    publish_end: bcI18n.uploaderPublishEnd\n                                };\n                                let message = response.responseJSON.message;\n                                if(response.responseJSON.errors !== undefined) {\n                                    message += \"\\n\";\n                                    Object.keys(response.responseJSON.errors).forEach(function (key) {\n                                        Object.keys(response.responseJSON.errors[key]).forEach(function (field) {\n                                            message += \"\\n・\" + fields[key] + '：' + response.responseJSON.errors[key][field];\n                                        });\n                                    });\n                                }\n                                alert(message);\n                            }\n                        });\n                    }, {hideLoader: false, useUpdate: false});\n                }\n            }\n        },\n        close: function () {\n            allFields.val('').removeClass('ui-state-error');\n        }\n\n    });\n\n    /**\n     * アップロードファイル選択時イベント\n     */\n    function uploaderFileFileChangeHandler() {\n        var url = $.bcUtil.apiAdminBaseUrl + 'bc-uploader/uploader_files/upload.json';\n        var $file = $(this);\n        $.bcUtil.showLoader();\n        if ($('#UploaderFileFile' + listId).val()) {\n            $.bcToken.check(function () {\n                let fd = new FormData();\n                fd.append('file', $file.prop('files')[0]);\n                fd.append('_csrfToken', $.bcToken.key);\n                if ($(\"#UploaderFileUploaderCategoryId\" + listId).length) {\n                    fd.append('uploader_category_id', $(\"#UploaderFileUploaderCategoryId\" + listId).val());\n                }\n                return $.ajax({\n                    url: url,\n                    headers: {\n                        \"Authorization\": $.bcJwt.accessToken,\n                    },\n                    type: 'post',\n                    data: fd,\n                    dataType: 'json',\n                    processData: false,\n                    contentType: false,\n                    cache: false,\n                    success: uploadSuccessHandler\n                });\n            }, {useUpdate: false, hideLoader: false});\n        }\n    }\n\n    /**\n     * アップロード完了後イベント\n     */\n    function uploadSuccessHandler(res) {\n\n        if (res) {\n            if ($('#UploaderFileUploaderCategoryId' + listId).length) {\n                $('#FilterUploaderCategoryId' + listId).val($('#UploaderFileUploaderCategoryId' + listId).val());\n                categoryId = $('#UploaderFileUploaderCategoryId' + listId).val();\n            }\n            updateFileList();\n        } else {\n            $('#ErrorMessage').remove();\n            $('#FileList' + listId).prepend('<p id=\"ErrorMessage\" class=\"message\">' + bcI18n.uploaderAlertMessage2 + '</p>');\n            $(\"#Waiting\").hide();\n        }\n        // フォームを初期化\n        // セキュリティ上の関係でvalue値を直接消去する事はできないので、一旦エレメントごと削除し、\n        // spanタグ内に新しく作りなおす。\n        $(\"#UploaderFileFile\" + listId).remove();\n        $(\"#SpanUploadFile\" + listId).append('<input id=\"UploaderFileFile' + listId + '\" type=\"file\" value=\"\" name=\"data[UploaderFile][file]\" class=\"uploader-file-file\" />');\n        $('#UploaderFileFile' + listId).change(uploaderFileFileChangeHandler);\n        $.bcToken.key = null;\n\n    }\n\n    /**\n     * 一覧を更新する\n     */\n    function updateFileList() {\n        $.bcUtil.ajax(getListUrl(), updateFileListCompleteHander, {hideLoader: false, type: 'GET'});\n    }\n\n    /**\n     * 指定したファイルの編集ができない状態か確認\n     *\n     * @param fileUserId\n     * @returns {boolean}\n     */\n    function isFileEditDisabled(fileUserId) {\n        var loginUserId = $(\"#LoginUserId\").html();\n        var loginUserGroupId = $(\"#LoginUserGroupId\").html();\n        var usePermission = Number($(\"#UsePermission\").html());\n        var disabled = false;\n        if (loginUserGroupId != 1 && usePermission) {\n            if (loginUserId != fileUserId) {\n                disabled = true;\n            }\n        }\n        return disabled;\n    }\n\n    /**\n     * 選択イベントを初期化する\n     */\n    function initFileList() {\n\n        var usePermission = $(\"#UsePermission\").html();\n\n        if (categoryId) {\n            $('#UploaderFileUploaderCategoryId' + listId).val(categoryId);\n        }\n        /* 一旦イベントを全て解除 */\n        $(\".selectable-file\").unbind('click.selectEvent');\n        $(\".selectable-file\").unbind('mouseenter.selectEvent');\n        $(\".selectable-file\").unbind('mouseleave.selectEvent');\n        $(\".page-numbers a\").unbind('click.paginationEvent');\n        $(\".selectable-file\").unbind('dblclick.dblclickEvent');\n        $(\".filter-control\").unbind('click.filterEvent');\n        $(\".btn-delete\").unbind('click');\n\n        /* 公開制限期間にあるファイルの背景色を定義 */\n        var unpublishBackGroundColor = '#bbb';\n\n        if ($.fn.contextMenu && !listId && $(\"#DivPanelList\").length) {\n            /* 右クリックメニューを追加 */\n            $(\"#DivPanelList\").contextMenu({\n                selector: '.selectable-file',\n                callback: contextMenuHander,\n                build: function ($trigger, e) {\n                    var disabled = isFileEditDisabled($($trigger).find('.user-id').html());\n                    return {\n                        items: {\n                            edit: {\n                                name: bcI18n.uploaderEdit,\n                                icon: 'edit',\n                                disabled: function (key, opt) {\n                                    return disabled;\n                                }\n                            },\n                            delete: {\n                                name: bcI18n.uploaderDelete,\n                                icon: 'delete',\n                                disabled: function (key, opt) {\n                                    return disabled;\n                                }\n                            }\n                        }\n                    }\n                }\n            });\n        }\n\n        $(\"#DivPanelList .selectable-file\").each(function () {\n\n            if ($.fn.contextMenu && !listId) {\n                if (!isFileEditDisabled($(this).find('.user-id').html())) {\n                    $(this).bind('dblclick.dblclickEvent', function () {\n                        $('#EditDialog').dialog('open');\n                    });\n                } else {\n                    $(this).bind('dblclick.dblclickEvent', function () {\n                        alert(bcI18n.uploaderAlertMessage3);\n                    });\n                }\n            } else {\n                $(this).bind(\"contextmenu\", function (e) {\n                    return false;\n                });\n            }\n\n            /* 公開制限期間にあるファイルは背景色をグレーにする */\n            if ($(this).hasClass('unpublish')) {\n                $(this).css('background-color', unpublishBackGroundColor);\n            }\n        });\n\n        // ファイルアップロードイベントを登録\n        $('#UploaderFileFile' + listId).change(uploaderFileFileChangeHandler);\n\n        if (listId) {\n            $(\".selectable-file\").bind('mouseenter.selectEvent', function () {\n                $(this).css('background-color', '#fffae7');\n            });\n            $(\".selectable-file\").bind('mouseleave.selectEvent', function () {\n                $(this).css('background-color', '#FFFFFF');\n                if ($(this).hasClass('unpublish')) {\n                    $(this).css('background-color', unpublishBackGroundColor);\n                }\n            });\n            $(\".selectable-file\").each(function () {\n                // IEの場合contextmenuを検出できなかったので、mousedownに変更した\n                $(this).bind('mousedown', function () {\n                    $(\".selectable-file\").removeClass('selected');\n                    $(this).addClass('selected');\n                });\n            });\n        } else {\n            $(\"#DivPanelList .selectable-file\").bind('mouseenter.selectEvent', function () {\n                $(this).css('background-color', '#fffae7');\n            });\n            $(\"#DivPanelList .selectable-file\").bind('mouseleave.selectEvent', function () {\n                $(this).css('background-color', '#FFFFFF');\n                if ($(this).hasClass('unpublish')) {\n                    $(this).css('background-color', unpublishBackGroundColor);\n                }\n            });\n            $(\"#DivPanelList .selectable-file\").each(function () {\n                // IEの場合contextmenuを検出できなかったので、mousedownに変更した\n                $(this).bind('mousedown', function () {\n                    $(\".selectable-file\").removeClass('selected');\n                    $(this).addClass('selected');\n                });\n            });\n        }\n\n        /* ページネーションイベントを追加 */\n        $('.page-numbers a').bind('click.paginationEvent', function () {\n            $(\"#Waiting\").show();\n            $.get($(this).attr('href'), updateFileListCompleteHander);\n            return false;\n        });\n\n        /*$('#FilterUploaderCategoryId'+listId).bind('change.filterEvent', function() {\n            $(\"#Waiting\").show();\n            $.get(getListUrl(),updateFileListCompleteHander);\n        });\n        $('input[name=\"data[Filter][uploader_type]\"]').bind('click.filterEvent', function() {\n            $(\"#Waiting\").show();\n            $.get(getListUrl(),updateFileListCompleteHander);\n        });*/\n\n        $(\"#FileList\" + listId).trigger(\"filelistload\");\n        $(\"#FileList\" + listId).effect(\"highlight\", {}, 1500);\n\n    }\n\n    /**\n     * ファイルリスト取得完了イベント\n     */\n    function updateFileListCompleteHander(result) {\n\n        $(\"#FileList\" + listId).html(result);\n        initFileList();\n        $(\"#FileList\" + listId).trigger('loadTableComplete');\n        $(\"#Waiting\").hide();\n\n    }\n\n    /**\n     * Ajax List 取得用のURLを取得する\n     */\n    function getListUrl() {\n        let listUrl = $(\"#ListUrl\" + listId).attr('href');\n        let query = [];\n        if ($('#FilterUploaderCategoryId' + listId).length) {\n            query.push('uploader_category_id=' + $('#FilterUploaderCategoryId' + listId).val());\n        } else {\n            query.push('uploader_category_id=');\n        }\n        if ($('input[name=\"uploader_type\"]:checked').length) {\n            query.push('uploader_type=' + $('input[name=\"uploader_type\"]:checked').val());\n        } else {\n            query.push('uploader_type=all');\n        }\n        if ($('#FilterName' + listId).val()) {\n            query.push('name=' + encodeURI($('#FilterName' + listId).val()));\n        } else {\n            query.push('name=');\n        }\n        const num = location.search.match('limit=([0-9]+)');\n        if(num) {\n            query.push('limit=' + num[1]);\n        }\n        if (query.length) {\n            listUrl += '?' + query.join('&');\n        }\n        return listUrl;\n    }\n\n    /**\n     * コンテキストメニューハンドラ\n     */\n    function contextMenuHander(action, el) {\n        let id = $(\"#FileList\" + listId + \" .selected .id\").html().trim();\n        let delUrl = $.bcUtil.apiAdminBaseUrl + 'bc-uploader/uploader_files/delete/' + id + '.json';\n\n        // IEの場合、action値が正常に取得できないので整形する\n        let pos = action.indexOf(\"#\");\n        if (pos !== -1) action = action.substring(pos + 1, action.length);\n\n        switch (action) {\n            case 'edit':\n                $('#EditDialog').dialog('open');\n                break;\n\n            case 'delete':\n                if (confirm(bcI18n.uploaderConfirmMessage1)) {\n                    $.bcToken.check(function () {\n                        $.ajax({\n                            url: delUrl,\n                            headers: {\n                                \"X-CSRF-Token\": $.bcToken.key,\n                            },\n                            type: 'post',\n                            dataType: 'json',\n                            beforeSend: function() {\n                                $(\"#Waiting\").show();\n                            },\n                            success: function () {\n                                $(\"#FileList\" + listId).trigger(\"deletecomplete\");\n                                updateFileList();\n                            },\n                            error: function () {\n                                alert(bcI18n.uploaderAlertMessage4);\n                            },\n                            complete: function(){\n                                $(\"#Waiting\").hide();\n                                $.bcToken.key = null;\n                            }\n                        });\n                    }, {useUpdate: false, hideLoader: false});\n                }\n                break;\n        }\n    }\n\n});\n"],"names":["$","listId","html","remove","allFields","add","categoryId","baseUrl","uploaderFileFileChangeHandler","url","bcUtil","apiAdminBaseUrl","$file","this","showLoader","val","bcToken","check","fd","FormData","append","prop","key","length","ajax","headers","bcJwt","accessToken","type","data","dataType","processData","contentType","cache","success","uploadSuccessHandler","useUpdate","hideLoader","res","updateFileList","prepend","bcI18n","uploaderAlertMessage2","hide","change","listUrl","attr","query","push","encodeURI","num","location","search","match","join","getListUrl","updateFileListCompleteHander","isFileEditDisabled","fileUserId","loginUserId","loginUserGroupId","usePermission","Number","disabled","result","unbind","unpublishBackGroundColor","fn","contextMenu","selector","callback","contextMenuHander","build","$trigger","e","find","items","edit","name","uploaderEdit","icon","opt","delete","uploaderDelete","each","bind","alert","uploaderAlertMessage3","dialog","hasClass","css","removeClass","addClass","show","get","trigger","effect","initFileList","action","el","id","trim","delUrl","pos","indexOf","substring","confirm","uploaderConfirmMessage1","beforeSend","error","uploaderAlertMessage4","complete","click","bgiframe","autoOpen","position","at","of","window","width","modal","open","publishBeginDate","publishBeginTime","publishBeginDateTime","publishEndDate","publishEndTime","publishEndDateTime","adminBaseUrl","after","buttons","cancel","text","uploaderCancel","save","uploaderSave","saveButton","response","fields","uploaderFile","publish_begin","uploaderPublishBegin","publish_end","uploaderPublishEnd","message","responseJSON","undefined","errors","Object","keys","forEach","field","close"],"sourceRoot":""}
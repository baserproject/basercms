/**
 * baserCMS :  Based Website Development Project <https://basercms.net>
 * Copyright (c) NPO baser foundation <https://baserfoundation.org/>
 *
 * @copyright     Copyright (c) NPO baser foundation
 * @link          https://basercms.net baserCMS Project
 * @since         5.0.0
 * @license       https://basercms.net/license/index.html MIT License
 */
uploaderFilesIndex={listId:null,allFields:null,categoryId:null,mounted:function(){var e=$("#ListId");this.listId=e.html(),e.remove(),this.allFields=$([]).add($("#name")).add($("#alt")),this.initView(),this.registerEvents()},initView:function(){this.updateFileList(),this.initDialog()},registerEvents:function(){$("#BtnFilter").click((function(){return uploaderFilesIndex.updateFileList(),!1}))},initDialog:function(){$("#EditDialog").dialog({bgiframe:!0,autoOpen:!1,position:{at:"center center",of:window},width:960,modal:!0,open:function(){var e=uploaderFilesIndex.listId,l=$("#FileList"+e+" .selected .name").html();$("#UploaderFileImage"+e+" .uploader-file-image-inner").remove(),$("#UploadFileImageLoader"+e).show(),$("#UploaderFileId"+e).val($("#FileList"+e+" .selected .id").html().trim()),$("#UploaderFileName"+e).val(l),$("#UploaderFileAlt"+e).val($("#FileList"+e+" .selected .alt").html());var i=$("#FileList"+e+" .selected .publish-begin").html().trim(),t=$("#FileList"+e+" .selected .publish-begin-time").html().trim();$("#UploaderFilePublishBegin-date").val(i),$("#UploaderFilePublishBegin-time").val(t);var a=i;t&&(a+=" "+t),$("#UploaderFilePublishBegin").val(a);var n=$("#FileList"+e+" .selected .publish-end").html().trim(),d=$("#FileList"+e+" .selected .publish-end-time").html().trim();$("#UploaderFilePublishEnd-date").val(n),$("#UploaderFilePublishEnd-time").val(d);var s=n;d&&(s+=" "+d),$("#UploaderFilePublishEnd").val(s),$("#UploaderFileUserId"+e).val($("#FileList"+e+" .selected .user-id").html()),$("#UploaderFileUserName"+e).html($("#FileList"+e+" .selected .user-name").html());var r=$("#_UploaderFileUploaderCategoryId"+e);r.length&&r.val($("#FileList"+e+" .selected .uploader-category-id").html()),$.ajax({url:$.bcUtil.adminBaseUrl+"bc-uploader/uploader_files/ajax_image/"+l+"/large",type:"get",dataType:"html",success:function(l){$("#UploadFileImageLoader"+e).hide().after(l)}})},buttons:{cancel:{text:bcI18n.uploaderCancel,click:function(){$(this).dialog("close")}},save:{text:bcI18n.uploaderSave,click:function(){var e=uploaderFilesIndex.listId,l=$(this),i=$("#UploaderFileId"+e).val();$.bcToken.check((function(){var t={id:i,name:$("#UploaderFileName"+e).val(),alt:$("#UploaderFileAlt"+e).val(),publish_begin:$("#UploaderFilePublishBegin"+e).val(),publish_end:$("#UploaderFilePublishEnd"+e).val(),user_id:$("#UploaderFileUserId"+e).val(),uploader_category_id:$("#_UploaderFileUploaderCategoryId"+e).val(),_csrfToken:$.bcToken.key};return $.ajax({url:$.bcUtil.apiAdminBaseUrl+"bc-uploader/uploader_files/edit/"+i+".json",type:"post",data:t,dataType:"json",success:function(){uploaderFilesIndex.updateFileList(),uploaderFilesIndex.allFields.removeClass("ui-state-error"),l.dialog("close")},error:function(e){var l={name:bcI18n.uploaderFile,publish_begin:bcI18n.uploaderPublishBegin,publish_end:bcI18n.uploaderPublishEnd},i=e.responseJSON.message;void 0!==e.responseJSON.errors&&(i+="\n",Object.keys(e.responseJSON.errors).forEach((function(t){Object.keys(e.responseJSON.errors[t]).forEach((function(a){i+="\n・"+l[t]+"："+e.responseJSON.errors[t][a]}))}))),alert(i)}})}),{hideLoader:!1,useUpdate:!1})}}},close:function(){uploaderFilesIndex.allFields.val("").removeClass("ui-state-error")}})},uploaderFileFileChangeHandler:function(){var e=$.bcUtil.apiAdminBaseUrl+"bc-uploader/uploader_files/upload.json",l=$(this),i=uploaderFilesIndex.listId;$.bcUtil.showLoader(),$("#UploaderFileFile"+i).val()&&$.bcToken.check((function(){var t=new FormData;return t.append("file",l.prop("files")[0]),t.append("_csrfToken",$.bcToken.key),$uploaderCategoryId=$("#UploaderFileUploaderCategoryId"+i),$uploaderCategoryId.length&&t.append("uploader_category_id",$uploaderCategoryId.val()),$.ajax({url:e,type:"post",data:t,dataType:"json",processData:!1,contentType:!1,cache:!1,beforeSend:function(){$.bcUtil.hideMessage()},success:uploaderFilesIndex.uploadSuccessHandler,error:function(e){e.responseJSON?$.bcUtil.showApiError(e):$.bcUtil.showAlertMessage("処理中にエラーが発生しました。ファイルが大きすぎる可能性があります。"),$.bcUtil.hideLoader()}})}),{useUpdate:!1,hideLoader:!1})},uploadSuccessHandler:function(e){var l=uploaderFilesIndex.listId;if(e){var i=$("#UploaderFileUploaderCategoryId"+l);i.length&&($("#FilterUploaderCategoryId"+l).val(i.val()),uploaderFilesIndex.categoryId=i.val()),uploaderFilesIndex.updateFileList()}else $("#ErrorMessage").remove(),$("#FileList"+l).prepend('<p id="ErrorMessage" class="message">'+bcI18n.uploaderAlertMessage2+"</p>"),$("#Waiting").hide();$("#UploaderFileFile"+l).remove(),$("#SpanUploadFile"+l).append('<input id="UploaderFileFile'+l+'" type="file" value="" name="data[UploaderFile][file]" class="uploader-file-file" />'),$("#UploaderFileFile"+l).change(uploaderFilesIndex.uploaderFileFileChangeHandler),$.bcToken.key=null},updateFileList:function(){$.bcUtil.ajax(uploaderFilesIndex.getListUrl(),uploaderFilesIndex.updateFileListCompleteHandler,{hideLoader:!1,type:"GET"})},isFileEditDisabled:function(e){var l=$("#LoginUserId").html(),i=$("#LoginUserGroupId").html(),t=Number($("#UsePermission").html()),a=!1;return 1!==parseInt(i)&&t&&parseInt(l)!==parseInt(e)&&(a=!0),a},initFileList:function(){var e=uploaderFilesIndex.listId;uploaderFilesIndex.categoryId&&$("#UploaderFileUploaderCategoryId"+e).val(uploaderFilesIndex.categoryId);var l=$(".selectable-file");l.unbind("click.selectEvent"),l.unbind("mouseenter.selectEvent"),l.unbind("mouseleave.selectEvent"),l.unbind("dblclick.dblclickEvent"),$(".page-numbers a").unbind("click.paginationEvent"),$(".filter-control").unbind("click.filterEvent"),$(".btn-delete").unbind("click");var i="#bbb";$divPanelList=$("#DivPanelList"),$.fn.contextMenu&&!e&&$divPanelList.length&&$divPanelList.contextMenu({selector:".selectable-file",callback:uploaderFilesIndex.contextMenuHandler,build:function(e,l){var i=uploaderFilesIndex.isFileEditDisabled($(e).find(".user-id").html());return{items:{edit:{name:bcI18n.uploaderEdit,icon:"edit",disabled:function(e,l){return i}},delete:{name:bcI18n.uploaderDelete,icon:"delete",disabled:function(e,l){return i}}}}}}),$selectableFileInPanelList=$("#DivPanelList .selectable-file"),$selectableFileInPanelList.each((function(){$.fn.contextMenu&&!e?uploaderFilesIndex.isFileEditDisabled($(this).find(".user-id").html())?$(this).bind("dblclick.dblclickEvent",(function(){alert(bcI18n.uploaderAlertMessage3)})):$(this).bind("dblclick.dblclickEvent",(function(){$("#EditDialog").dialog("open")})):$(this).bind("contextmenu",(function(e){return!1})),$(this).hasClass("unpublish")&&$(this).css("background-color",i)})),$("#UploaderFileFile"+e).change(uploaderFilesIndex.uploaderFileFileChangeHandler),e?(l.bind("mouseenter.selectEvent",(function(){$(this).css("background-color","#fffae7")})),l.bind("mouseleave.selectEvent",(function(){$(this).css("background-color","#FFFFFF"),$(this).hasClass("unpublish")&&$(this).css("background-color",i)})),l.each((function(){$(this).bind("mousedown",(function(){l.removeClass("selected"),$(this).addClass("selected")}))}))):($selectableFileInPanelList.bind("mouseenter.selectEvent",(function(){$(this).css("background-color","#fffae7")})),$selectableFileInPanelList.bind("mouseleave.selectEvent",(function(){$(this).css("background-color","#FFFFFF"),$(this).hasClass("unpublish")&&$(this).css("background-color",i)})),$selectableFileInPanelList.each((function(){$(this).bind("mousedown",(function(){l.removeClass("selected"),$(this).addClass("selected")}))}))),$(".page-numbers a").bind("click.paginationEvent",(function(){return $("#Waiting").show(),$.get($(this).attr("href"),uploaderFilesIndex.updateFileListCompleteHandler),!1})),$(".bca-list-num a").on("click.listNumEvent",(function(){return $("#Waiting").show(),$.get($(this).attr("href"),uploaderFilesIndex.updateFileListCompleteHandler),!1}));var t=$("#FileList"+e);t.trigger("filelistload"),t.effect("highlight",{},1500)},updateFileListCompleteHandler:function(e){var l=uploaderFilesIndex.listId,i=$("#FileList"+l);i.html(e),uploaderFilesIndex.initFileList(),i.trigger("loadTableComplete"),$("#Waiting").hide()},getListUrl:function(){var e=uploaderFilesIndex.listId,l=$("#ListUrl"+e).attr("href"),i=[],t=$("#FilterUploaderCategoryId"+e);t.length?i.push("uploader_category_id="+t.val()):i.push("uploader_category_id=");var a=$('input[name="uploader_type"]:checked');a.length?i.push("uploader_type="+a.val()):i.push("uploader_type=all");var n=$("#FilterName"+e);n.val()?i.push("name="+encodeURI(n.val())):i.push("name=");var d=location.search.match("limit=([0-9]+)");return d&&i.push("limit="+d[1]),i.length&&(l+="?"+i.join("&")),l},contextMenuHandler:function(e,l){var i=uploaderFilesIndex.listId,t=$("#FileList"+i+" .selected .id").html().trim(),a=$.bcUtil.apiAdminBaseUrl+"bc-uploader/uploader_files/delete/"+t+".json",n=$("#selectedFile"+t+" .name").text().trim(),d=e.indexOf("#");switch(-1!==d&&(e=e.substring(d+1,e.length)),e){case"edit":$("#EditDialog").dialog("open");break;case"delete":confirm(n+bcI18n.uploaderConfirmMessage1)&&$.bcToken.check((function(){$.ajax({url:a,headers:{"X-CSRF-Token":$.bcToken.key},type:"post",dataType:"json",beforeSend:function(){$("#Waiting").show()},success:function(){$("#FileList"+i).trigger("deletecomplete"),uploaderFilesIndex.updateFileList()},error:function(){alert(bcI18n.uploaderAlertMessage4)},complete:function(){$("#Waiting").hide(),$.bcToken.key=null}})}),{useUpdate:!1,hideLoader:!1})}}},uploaderFilesIndex.mounted();
//# sourceMappingURL=index_panel.bundle.js.map
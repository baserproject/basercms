{"version":3,"file":"bc_blog/js/blog_comment.bundle.js","mappings":"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","sources":["webpack://bc-front/./src/bc_blog/js/blog_comment.js"],"sourcesContent":["/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) NPO baser foundation <https://baserfoundation.org/>\n *\n * @copyright     Copyright (c) NPO baser foundation\n * @link          https://basercms.net baserCMS Project\n * @since         5.0.0\n * @license       https://basercms.net/license/index.html MIT License\n */\n\n/**\n * ブログコメント送信\n */\nconst bcBlog = {\n\n    /**\n     * コメントの承認あり・なし\n     */\n    commentApprove: false,\n\n    /**\n     * キャプチャ認証を利用するかどうか\n     */\n    authCaptcha: false,\n\n    /**\n     * キャプチャID\n     */\n    captchaId: null,\n\n    /**\n     * キャプチャのベースURL\n     */\n    authCaptchaImageBaseUrl: null,\n\n    /**\n     * 初期化\n     */\n    mounted() {\n        const $script = $(\"#BlogCommentsScripts\");\n        bcBlog.commentApprove = $script.attr('data-commentApprove');\n        bcBlog.authCaptcha = $script.attr('data-authCaptcha');\n        bcBlog.captchaId = $script.attr('data-captchaId');\n        bcBlog.authCaptchaImageBaseUrl = $script.attr('data-authCaptchaImageBaseUrl');\n        bcBlog.initView();\n        bcBlog.registerEvents();\n    },\n\n    /**\n     * イベント登録\n     */\n    registerEvents() {\n        $(\"#BlogCommentAddButton\").on('click', function () {\n            if(bcBlog.validate()) {\n                bcBlog.sendComment();\n            }\n            return false;\n        });\n    },\n\n    /**\n     * 表示を初期化する\n     */\n    initView() {\n        if(bcBlog.authCaptcha) bcBlog.loadAuthCaptcha();\n        $(\"#name\").val('');\n        $(\"#email\").val('');\n        $(\"#url\").val('');\n        $(\"#message\").val('');\n    },\n\n    /**\n     * コメントを送信する\n     */\n    sendComment() {\n        $(\"#BlogCommentAddButton\").prop('disabled', true);\n        $.bcToken.check(function () {\n            let form = $(\"#BlogCommentAddForm\");\n            form.find('input[name=\"_csrfToken\"]').remove();\n            form.append($.bcToken.getHiddenToken());\n            return $.ajax({\n                url: $.bcUtil.baseUrl + '/bc-blog/blog/ajax_add_comment',\n                type: 'POST',\n                data: form.serialize(),\n                dataType: 'html',\n                beforeSend: function () {\n                    $(\"#ResultMessage\").slideUp();\n                },\n                success: function (result) {\n                    if(bcBlog.authCaptcha) {\n                        bcBlog.loadAuthCaptcha();\n                        $(\"#auth-captcha\").val('');\n                    }\n                    if (result) {\n                        bcBlog.initView()\n                        $(\"#auth-captcha\").val('');\n                        let resultMessage = '';\n                        if (bcBlog.commentApprove) {\n                            resultMessage = bcI18n.alertMessageAuthComplete;\n                            $(\"#ResultMessage\").html(resultMessage).show();\n                        } else {\n                            let comment = $(result);\n                            comment.hide();\n                            $(\"#BlogCommentList\").append(comment);\n                            comment.slideDown(500);\n                            location.hash = comment.attr('id');\n                        }\n                    } else {\n                        bcBlog.postError();\n                    }\n                },\n                error: function (result) {\n                    bcBlog.postError(result);\n                },\n                complete: function () {\n                    $.bcToken.key = null;\n                    $(\"#BlogCommentAddButton\").removeAttr('disabled');\n                }\n            });\n        }, {useUpdate: false});\n    },\n\n    /**\n     * エラー処理\n     */\n    postError(result) {\n        if(bcBlog.authCaptcha) {\n            bcBlog.loadAuthCaptcha();\n            $(\"#BlogCommentAuthCaptcha\").val('');\n        }\n        let message = bcI18n.alertMessageError;\n        if(result.responseText) {\n            response = JSON.parse(result.responseText);\n        }\n        message += '<br>' + response.message;\n        if(response.errors) {\n            Object.keys(response.errors).forEach(function(k) {\n                Object.keys(response.errors[k]).forEach(function(f){\n                    message += '<br>' + response.errors[k][f];\n                });\n            });\n        }\n        $(\"#ResultMessage\").html(message).slideDown();\n    },\n\n    /**\n     * バリデーション\n     */\n    validate() {\n        let msg = '';\n        if (!$(\"#name\").val()) {\n            msg += bcI18n.alertMessageName + '\\n';\n        }\n        if (!$(\"#message\").val()) {\n            msg += bcI18n.alertMessageComment + '\\n';\n        }\n        if (bcBlog.authCaptcha) {\n            if (!$(\"#auth-captcha\").val()) {\n                msg += bcI18n.alertMessageAuthImage + '\\n';\n            }\n        }\n        if (msg) {\n            alert(msg);\n            return false;\n        }\n        return true;\n    },\n\n    /**\n     * キャプチャ画像を読み込む\n     */\n    loadAuthCaptcha() {\n        if (bcBlog.authCaptcha) {\n            const $authCaptchaImage = $(\"#AuthCaptchaImage\");\n            const $captchaLoader = $(\"#CaptchaLoader\");\n            $authCaptchaImage.hide();\n            $captchaLoader.show();\n            $authCaptchaImage.on('load', function () {\n                $captchaLoader.hide();\n                $authCaptchaImage.fadeIn(1000);\n            });\n            $authCaptchaImage.attr('src', bcBlog.authCaptchaImageBaseUrl + '/' + bcBlog.captchaId);\n        }\n    }\n\n}\n\nbcBlog.mounted();\n\n\n\n\n\n"],"names":["bcBlog","commentApprove","authCaptcha","captchaId","authCaptchaImageBaseUrl","mounted","$script","$","attr","initView","registerEvents","on","validate","sendComment","loadAuthCaptcha","val","prop","bcToken","check","form","find","remove","append","getHiddenToken","ajax","url","bcUtil","baseUrl","type","data","serialize","dataType","beforeSend","slideUp","success","result","resultMessage","bcI18n","alertMessageAuthComplete","html","show","comment","hide","slideDown","location","hash","postError","error","complete","key","removeAttr","useUpdate","message","alertMessageError","responseText","response","JSON","parse","errors","Object","keys","forEach","k","f","msg","alertMessageName","alertMessageComment","alertMessageAuthImage","alert","$authCaptchaImage","$captchaLoader","fadeIn"],"sourceRoot":""}